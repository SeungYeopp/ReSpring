# 오늘의 학습 정리 (2025년 1월 16일, 목요일)

ERD 작성에 앞서 엔티티 매핑에 대한 내용을 학습했습니다.

---

## 다양한 연관관계 매핑

### 1. 연관관계 매핑 시 고려사항
- **다중성**
  - 다대일: `@ManyToOne`
  - 일대다: `@OneToMany`
  - 일대일: `@OneToOne`
  - 다대다: `@ManyToMany`

- **단방향, 양방향**
  - 테이블: 외래 키 하나로 양쪽 조인 가능
  - 객체: 참조용 필드가 있는 쪽으로만 참조 가능

- **연관관계의 주인**
  - 외래 키를 관리하는 객체가 연관관계의 주인이 됨.

---

### 2. 연관관계 매핑 유형

#### 다대일 [N:1]
- **단방향**: 가장 일반적으로 사용.
- **양방향**: 외래 키가 있는 쪽이 연관관계의 주인.

#### 일대다 [1:N]
- **단방향**
  - 특이한 구조로 `@JoinColumn` 필수.
  - 추가 `UPDATE SQL` 실행 필요.
- **양방향**: 공식적으로 지원하지 않음.

#### 일대일 [1:1]
- 외래 키를 주 테이블 또는 대상 테이블 중 어디에 둘지 선택 가능.
- **주 테이블에 외래 키**
  - JPA 매핑이 편리하고 객체지향적.
- **대상 테이블에 외래 키**
  - 데이터베이스 구조 유지에 유리.

#### 다대다 [N:M]
- 관계형 데이터베이스에서는 연결 테이블 추가 필요.
- **실무에서 @ManyToMany 사용 권장 안 함**:
  - 연결 테이블에 추가 데이터를 포함할 수 있기 때문.

---

### 3. 실전 예제
- **배송**: 주문과 배송의 관계는 1:1.
- **카테고리**: 상품과 카테고리의 관계는 N:M.

#### N:M 관계의 실무적 구현
- 중간 테이블을 활용해 1:N과 N:1로 분리.

---

### 4. 주요 어노테이션 속성

#### `@JoinColumn`
| 속성                  | 설명                                      | 기본값                                      |
|-----------------------|-------------------------------------------|---------------------------------------------|
| `name`               | 매핑할 외래 키 이름                      | 필드명 + `_` + 참조하는 테이블의 기본 키 컬럼명 |
| `referencedColumnName`| 외래 키가 참조하는 대상 테이블의 컬럼명   | 참조하는 테이블의 기본 키 컬럼명             |
| `foreignKey(DDL)`     | 외래 키 제약조건을 직접 지정할 수 있다.   | 이 속성은 테이블을 생성할 때만 사용한다.       |
| `unique`<br>`nullable`<br>`insertable`<br>`updatable`<br>`columnDefinition`<br>`table` | @Column의 속성과 같다. | |

---

#### `@ManyToOne`
| 속성           | 설명                                                                                   | 기본값                                   |
|----------------|----------------------------------------------------------------------------------------|------------------------------------------|
| `optional`     | `false`로 설정하면 연관된 엔티티가 항상 있어야 한다.                                     | `TRUE`                                   |
| `fetch`        | 글로벌 페치 전략을 설정한다.                                                            | - `@ManyToOne=FetchType.EAGER`<br>- `@OneToMany=FetchType.LAZY` |
| `cascade`      | 영속성 전이 기능을 사용한다.                                                             |                                          |
| `targetEntity` | 연관된 엔티티의 타입 정보를 설정한다. 이 기능은 거의 사용하지 않는다.<br>컬렉션을 사용해도 제네릭으로 타입 정보를 알 수 있다. |                                          |

---

#### `@OneToMany`
| 속성           | 설명                                                                                   | 기본값                                   |
|----------------|----------------------------------------------------------------------------------------|------------------------------------------|
| `mappedBy`     | 연관관계의 주인 필드를 선택한다.                                                        |                                          |
| `fetch`        | 글로벌 페치 전략을 설정한다.                                                            | - `@ManyToOne=FetchType.EAGER`<br>- `@OneToMany=FetchType.LAZY` |
| `cascade`      | 영속성 전이 기능을 사용한다.                                                             |                                          |
| `targetEntity` | 연관된 엔티티의 타입 정보를 설정한다. 이 기능은 거의 사용하지 않는다.<br>컬렉션을 사용해도 제네릭으로 타입 정보를 알 수 있다. |                                          |


---

### 느낀 점
- JPA 연관관계 매핑은 객체와 데이터베이스 간의 차이를 명확히 이해해야 함.
- 특히, 실무에서는 다대다 관계를 어떻게 처리하는지가 중요.
- 단방향과 양방향 매핑의 장단점을 잘 이해하고 상황에 맞게 설계해야 함.